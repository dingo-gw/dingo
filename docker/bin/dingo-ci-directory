#!/bin/bash

# creates and prints the path to a new directory in the base directory, which is
# /tmp/dingo by default or the argument pass to this script (if any)
# The name of the created directory is based on the current date and time.

BASE_DIR=$1

# Verify base directory exists or can be created
if ! mkdir -p "$BASE_DIR"; then
    echo "Failed to create base directory '$BASE_DIR'" >&2
    exit 1
fi

# Verify base directory is writable
if [ ! -w "$BASE_DIR" ]; then
    echo "Base directory '$BASE_DIR' is not writable" >&2
    exit 1
fi

# Get current timestamp for unique run directory
CURRENT_DATETIME="$(date +"%Y-%m-%d_%H-%M-%S")"
RUN_DIR="${BASE_DIR}/${CURRENT_DATETIME}"

# Create and verify run directory
if ! mkdir -p "$RUN_DIR"; then
    echo "Failed to create run directory '$RUN_DIR'" >&2
    exit 1
fi

# Output the run directory path
echo "$RUN_DIR"

